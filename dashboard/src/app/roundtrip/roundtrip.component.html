<div class="p-4 flex flex-col gap-4">
    @for (msg of messages(); track msg) {
        <div class="chat chat-start">
            <div class="chat-bubble chat-bubble-primary">
                <div class="text-[10px] uppercase font-bold opacity-50 mb-1">Topic: {{msg.topic}}</div>
                <div class="flex items-center gap-2">
                    <span class="badge badge-sm badge-outline">{{msg.values[0].type}}</span>

                    @switch (msg.values[0].type) {
                        @case ('Text') { <span>{{msg.values[0].value}}</span> }
                        @case ('Int') { <span class="font-mono text-info">{{msg.values[0].value}}</span> }
                        @case ('Bool') {
                            <div class="badge" [class.badge-success]="msg.values[0].value" [class.badge-error]="!msg.values[0].value">
                                {{msg.values[0].value}}
                            </div>
                        }
                        @case ('Node') {
                            <span class="text-sm">ID: {{msg.values[0].id}}</span>
                        }
                    }
                </div>
            </div>
        </div>
    }

    <div class="chat chat-start">
        <div class="chat-bubble chat-bubble-primary flex flex-col gap-3 max-w-md text-base-content">
            <label class="input input-sm input-bordered flex items-center gap-2">
                <input type="text" class="grow" [value]="sendTopic()" (input)="sendTopic.set($any($event.target).value)" placeholder="Topic" />
            </label>

            <div class="join">
                <select class="select select-sm select-bordered join-item"
                        [value]="selectedType()"
                        (change)="selectedType.set($any($event.target).value)">
                    <option value="Text">Text</option>
                    <option value="Int">Int</option>
                    <option value="Bool">Bool</option>
                    <option value="Node">Node</option>
                </select>

                @switch (selectedType()) {
                    @case ('Bool') {
                        <div class="join-item grow bg-base-100 border border-base-300 flex items-center px-4">
                            <input type="checkbox" class="toggle toggle-info toggle-xs"
                                   [checked]="boolValue()" (change)="boolValue.set(!boolValue())" />
                        </div>
                    }
                    @case ('Int') {
                        <input type="number" class="input input-sm input-bordered join-item grow"
                               [value]="intValue()" (input)="intValue.set($any($event.target).value)" placeholder="Number" />
                    }
                    @case ('Node') {
                        <input type="number" class="input input-sm input-bordered join-item w-16"
                               [value]="nodeId()" (input)="nodeId.set($any($event.target).value)" placeholder="ID" />
                        <input type="text" class="input input-sm input-bordered join-item grow"
                               [value]="nodeLabels()" (input)="nodeLabels.set($any($event.target).value)" placeholder="Labels..." />
                    }
                    @default {
                        <input type="text" class="input input-sm input-bordered join-item grow"
                               [value]="textValue()" (input)="textValue.set($any($event.target).value)" placeholder="Value" />
                    }
                }
            </div>

            <div class="flex w-full justify-end">
                <button class="btn btn-sm" [disabled]="!sendTopic()" (click)="send()">Send</button>
            </div>
        </div>
    </div>
</div>

<div class="chat chat-end">
    <div class="chat-bubble chat-bubble-primary flex flex-col gap-3 max-w-md text-base-content">
        <label class="input input-sm input-bordered flex items-center gap-2">
            <input type="text" class="grow" [value]="recTopic()" (input)="recTopic.set($any($event.target).value)" placeholder="Topic" />
        </label>
        <div class="flex w-full justify-end">
            @if (connected()) {
                <button (click)="stopListen()" class="btn btn-sm">Stop</button>
            } @else {
                <button class="btn btn-sm" [disabled]="!recTopic()" (click)="listen()">Listen</button>
            }
        </div>
    </div>
</div>

@if (recTopic() != null && recTopic().trim().length != 0) {
    <div class="flex items-center my-6 gap-4">
        <div class="flex-grow h-px bg-gradient-to-r from-transparent via-primary/30 to-transparent"></div>
        <span class="text-[10px] uppercase tracking-widest opacity-40 font-bold">Live Stream: {{recTopic()}}</span>
        <div class="flex-grow h-px bg-gradient-to-r from-transparent via-primary/30 to-transparent"></div>
    </div>
}


<div class="flex flex-col-reverse">
@for (msg of _received(); track msg.values[0]) {
    <div class="chat chat-end">
        <div class="chat-bubble chat-bubble-primary">
            <div class="text-[10px] uppercase font-bold opacity-50 mb-1">Topic: {{msg.topic}}</div>
            <div class="flex items-center gap-2">
                <span class="badge badge-sm badge-outline">{{msg.values[0].type}}</span>

                @switch (msg.values[0].type) {
                    @case ('Text') { <span>{{msg.values[0].value}}</span> }
                    @case ('Int') { <span class="font-mono text-info">{{msg.values[0].value}}</span> }
                    @case ('Bool') {
                        <div class="badge" [class.badge-success]="msg.values[0].value" [class.badge-error]="!msg.values[0].value">
                            {{msg.values[0].value}}
                        </div>
                    }
                    @case ('Node') {
                        <span class="text-sm">ID: {{msg.values[0].id}}</span>
                    }
                    @case ('Dict') {
                        <pre class="text-sm overflow-x-auto whitespace-pre-wrap">{{JSON.stringify(msg.values[0])}}</pre>
                    }
                    @case ('Array') {
                        <pre class="text-sm overflow-x-auto whitespace-pre-wrap">{{JSON.stringify(msg.values[0])}}</pre>
                    }
                }
            </div>
        </div>
    </div>
}
</div>